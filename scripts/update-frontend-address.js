// Node script: read Truffle artifact and write frontend/src/config.js
import fs from 'fs';
import path from 'path';

const artifactPath = path.resolve(process.cwd(), 'build/contracts/ReviewSystem.json');
if (!fs.existsSync(artifactPath)) {
  console.error('Artifact not found at', artifactPath);
  process.exit(1);
}
const artifact = JSON.parse(fs.readFileSync(artifactPath, 'utf-8'));
const networks = artifact.networks || {};
const networkIds = Object.keys(networks);
if (networkIds.length === 0) {
  console.error('No deployed networks in artifact');
  process.exit(1);
}
const lastNetId = networkIds[networkIds.length - 1];
const address = networks[lastNetId].address;
if (!address) {
  console.error('No address for network', lastNetId);
  process.exit(1);
}

const frontendConfig = path.resolve(process.cwd(), 'frontend/src/config.js');
let output = `// Auto-generated by scripts/update-frontend-address.js\nexport const CONTRACT_ADDRESS = "${address}";\n`;
fs.writeFileSync(frontendConfig, output);
console.log('Updated frontend/src/config.js with address:', address);
